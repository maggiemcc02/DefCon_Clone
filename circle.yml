machine:
  services:
    - docker

dependencies:
  override:
    - /bin/true

test:
  override:
    - >
        docker run
        -v $(pwd):/home/fenics/defcon
        -w /home/fenics/defcon
        -v $CIRCLE_TEST_REPORTS:/tmp/circle
        quay.io/fenicsproject/dev:py3
        '
        pip3 install --user h5py

        pip3 install --user .

        mpirun -n 2 python3 -m pytest -vxl --junitxml /tmp/circle/junit/report.xml
        '
